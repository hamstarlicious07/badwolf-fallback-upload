<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bad Wolf ‚Äî Image upload</title>

  <!-- Zain font -->
  <link href="https://fonts.googleapis.com/css2?family=Zain:wght@400..800&display=swap" rel="stylesheet">

  <style>
    :root { color-scheme: dark; }
    * { box-sizing: border-box; }
    html,body { height:100%; }
    body {
      margin:0; background:#0d0d0f; color:#f2f2f2;
      font-family: "Zain", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      display:flex; align-items:center; justify-content:center;
    }
    .wrap { width:min(720px, 92vw); margin:auto; text-align:center; }

    .emoji {
      font-size:112px; line-height:1; margin:6vh 0 2vh;
      display:inline-block; filter: drop-shadow(0 6px 22px rgba(0,0,0,.35));
    }
    h1 {
      font-size:clamp(36px, 5.8vw, 72px);
      margin: 0 0 10px; letter-spacing:.5px;
    }
    p.sub { margin:.25rem 0 40px; color:#bdbdc7; font-size:clamp(16px, 2.6vw, 20px); }

    .buttons { display:flex; gap:18px; justify-content:center; flex-wrap:wrap; }
    .btn {
      background:#6c4df8; color:#fff; border:0; border-radius:16px;
      padding:16px 22px; font-weight:800; font-size:clamp(16px, 2.6vw, 20px);
      box-shadow: 0 10px 30px rgba(108,77,248,.25);
      transition: transform .06s ease, filter .15s ease;
      cursor:pointer;
      display:flex; align-items:center; gap:10px;
    }
    .btn.secondary { background:#2a2a36; box-shadow:none; }
    .btn:active { transform: translateY(1px) scale(.99); }

    .out {
      display:none; margin:20px auto 0; max-width:840px;
      gap:10px; align-items:center; justify-content:center;
      padding:0 10px;
    }
    .row { display:flex; width:100%; gap:10px; }
    input.url {
      flex:1; background:#141418; color:#dcdce6; border:1px solid #2a2a36;
      padding:14px 16px; border-radius:14px; font-size:16px;
      text-overflow:ellipsis;
    }
    input.url:disabled { opacity:.9; }
    .copy {
      white-space:nowrap; padding:14px 20px; border-radius:14px; border:0;
      background:#6c4df8; color:#fff; font-weight:800; cursor:pointer;
    }

    #toast {
      position:fixed; left:50%; bottom:26px; transform:translateX(-50%);
      background:#1b1b22; color:#fff; padding:12px 16px;
      border-radius:999px; box-shadow:0 10px 30px rgba(0,0,0,.35);
      opacity:0; transition:opacity .22s ease;
      pointer-events:none;
      font-weight:700;
    }

    /* hide the real file inputs */
    input[type=file]{ display:none; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="emoji">üñºÔ∏è</div>
    <h1>Image upload</h1>
    <p class="sub">Capture or upload a photo ‚Üí Gets uploaded ‚Üí Copy URL</p>

    <!-- hidden inputs -->
    <input id="cam"   type="file" accept="image/*" capture="environment">
    <input id="pick"  type="file" accept="image/*">

    <div class="buttons">
      <button id="takeBtn" class="btn">üì∑ Take a photo</button>
      <button id="upBtn"   class="btn secondary">üñºÔ∏è Upload photo</button>
    </div>

    <div id="out" class="out">
      <div class="row">
        <input id="url" class="url" readonly placeholder="Image URL will appear here">
        <button id="copy" class="copy">Copy</button>
      </div>
    </div>
  </div>

  <div id="toast"></div>

<script>
  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ EDIT THESE IF NEEDED ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  const CLOUD_NAME    = "dbvq3eily";
  const UPLOAD_PRESET = "badwolf_unsigned";
  const FOLDER        = "badwolf/transactions";
  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */

  // Elements
  const takeBtn = document.getElementById('takeBtn');
  const upBtn   = document.getElementById('upBtn');
  const camInp  = document.getElementById('cam');
  const pickInp = document.getElementById('pick');
  const outWrap = document.getElementById('out');
  const urlEl   = document.getElementById('url');
  const copyBtn = document.getElementById('copy');
  const toast   = document.getElementById('toast');

  function toastMsg(msg){
    toast.textContent = msg;
    toast.style.opacity = 1;
    clearTimeout(toast._t);
    toast._t = setTimeout(()=> toast.style.opacity = 0, 1600);
  }

  // Downscale on-device to keep things tiny but clear
  async function downscale(file, maxW=1280, maxH=1280, quality=0.72){
    const img = await createImageBitmap(file);
    let { width:w, height:h } = img;
    const scale = Math.min(1, maxW / w, maxH / h);
    const W = Math.round(w * scale), H = Math.round(h * scale);

    const canvas = (typeof OffscreenCanvas !== "undefined")
      ? new OffscreenCanvas(W, H)
      : Object.assign(document.createElement('canvas'), {width:W, height:H});
    if (!canvas.width) { canvas.width = W; canvas.height = H; }

    const ctx = canvas.getContext('2d', {alpha:false});
    ctx.drawImage(img, 0, 0, W, H);

    // to Blob
    if (canvas.convertToBlob) {
      return await canvas.convertToBlob({ type:'image/jpeg', quality });
    } else {
      return await new Promise(res => canvas.toBlob(res, 'image/jpeg', quality));
    }
  }

  async function uploadToCloudinary(fileOrBlob){
    const fd = new FormData();
    fd.append('file', fileOrBlob);
    fd.append('upload_preset', UPLOAD_PRESET);
    if (FOLDER) fd.append('folder', FOLDER);

    const resp = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
      method: 'POST', body: fd
    });
    if (!resp.ok) throw new Error('Upload failed');
    return resp.json();
  }

  function setBusy(btn, busyText){
    btn._orig = btn._orig || btn.textContent;
    btn.disabled = true; btn.textContent = busyText;
  }
  function clearBusy(btn){
    btn.disabled = false; btn.textContent = btn._orig || btn.textContent;
  }

  async function handleFiles(list, sourceBtn){
    const file = list && list[0];
    if (!file) return;
    setBusy(sourceBtn, 'Uploading‚Ä¶');
    try {
      const small = await downscale(file);
      const info  = await uploadToCloudinary(small);
      const url   = info.secure_url;

      urlEl.value = url;
      outWrap.style.display = 'block';

      try {
        await navigator.clipboard.writeText(url);
        toastMsg('‚úÖ URL copied');
      } catch {
        toastMsg('URL ready ‚Äî tap to copy');
      }
    } catch (e) {
      console.error(e);
      toastMsg('‚ùå Upload failed');
    } finally {
      clearBusy(sourceBtn);
      camInp.value = ''; pickInp.value = '';
    }
  }

  // Openers
  takeBtn.addEventListener('click', ()=> camInp.click());
  upBtn  .addEventListener('click', ()=> pickInp.click());

  // Handlers
  camInp .addEventListener('change', e => handleFiles(e.target.files, takeBtn));
  pickInp.addEventListener('change', e => handleFiles(e.target.files, upBtn));

  // Copy actions
  copyBtn.addEventListener('click', async ()=>{
    if (!urlEl.value) return;
    try { await navigator.clipboard.writeText(urlEl.value); toastMsg('‚úÖ Copied'); }
    catch { toastMsg('Copy blocked ‚Äî long-press the field'); }
  });

  // Make the URL field itself one-tap copy
  urlEl.addEventListener('click', async ()=>{
    if (!urlEl.value) return;
    try { await navigator.clipboard.writeText(urlEl.value); toastMsg('‚úÖ Copied'); }
    catch { toastMsg('Copy blocked ‚Äî long-press the field'); }
  });
</script>
</body>
</html>
